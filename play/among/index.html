<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Loading...</title>
    <style>
        body { background: #000; color: #555; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: sans-serif; overflow: hidden; }
        .box { text-align: center; }
        .loader { width: 40px; height: 40px; border: 3px solid #222; border-top-color: #0cf; border-radius: 50%; animation: s 1s infinite linear; margin: 0 auto 20px; }
        @keyframes s { to { transform: rotate(360deg); } }
        #t { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>
    <div class="box">
        <div class="loader"></div>
        <div id="t">Booting...</div>
    </div>
    <script>
        (async function() {
            const t = document.getElementById('t');
            try {
                const cR = await fetch('/play/among/split/config.json');
                const config = await cR.json();
                const total = config.parts;
                
                let buffers = [];
                for (let i = 1; i <= total; i++) {
                    t.innerText = "Fetch Part " + i + "/" + total;
                    const res = await fetch('/play/among/split/part' + i.toString().padStart(3, '0'));
                    if (!res.ok) throw new Error("Part " + i + " 404");
                    buffers.push(await res.arrayBuffer());
                }

                t.innerText = "Syncing Bytes...";
                // Reassemble exactly as binary to avoid encoding shifts
                const blob = new Blob(buffers, { type: 'text/html' });
                const reader = new FileReader();
                reader.onload = () => {
                    t.innerText = "Ignition...";
                    // Using document.open/write on the top level but with binary-safe string
                    document.open();
                    document.write(reader.result);
                    document.close();
                };
                reader.readAsText(blob); // This is safer than window.location for games with local assets

            } catch (e) {
                t.innerText = "Critical: " + e.message;
                t.style.color = "red";
            }
        })();
    </script>
</body>
</html>